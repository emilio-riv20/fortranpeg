<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de CST</title>
</head>
<body>
    <h1>Generador de CST - Sin Node.js</h1>
    <button onclick="generarArchivos()">Generar Archivos</button>
    <script>
        // Simulación de Nodes.js
        const nodes = {

Produccion:{
    id: "string",
    alias: "?string",
    expresion: "Opciones",
},

Opciones:{
    concatenacion:"Union[]",
},

Union:{
    expresion: "Expresion[]",
},

Expresion:{
    label: "?Etiqueta",
    varios: "?Varios",
    expresiones: "Expresiones[]",
    cierres: "?Cierres",
    conteo: "?Conteo",
},

Etiqueta:{
    arroba: "?string",
    id: "string",
    varios: "?Varios",
},

Varios:{
   value: "string",   
},

Expresiones:{
    id: "Identificador",
    alias: "string",
    i: "?i",
    opciones: "Opciones[]",
    corchetes: "Corchetes",
},

Cierres:{
    value: "string",
},

Conteo:{
    number: "Number",
    id: "Identificador",
    opciones: "Opciones[]",
},

Corchetes:{
    rango: "Caracter",
    contenido: "Contenido",
},

Caracter:{
    value: "string",
},

Contenido:{
    corchetes: "Corchete",
    texto: "Texto",
},

Corchete:{
    value: "Contenido",
},

Texto:{
    value: "string",
},

Identificador:{
    id: "string",
},

Number:{
    value: "string",
},

};

        function generarArchivos() {
            generarVisitor();
            generarCST();
            alert("¡Archivos generados y descargados!");
        }

        function generarVisitor() {
            let visitorCode = "// Auto-generated Visitor.js\n";
            visitorCode += "export default class Visitor {\n";
            for (const node in nodes) {
                visitorCode += `    visit${node}(node) {\n`;
                visitorCode += `        throw new Error('visit${node} not implemented');\n`;
                visitorCode += `    }\n`;
            }
            visitorCode += "}";
            descargarArchivo(visitorCode, "Visitor.js");
        }

        function generarCST() {
            let cstCode = "// Auto-generated CST.js\nimport Visitor from './Visitor.js';\n";
            for (const [name, args] of Object.entries(nodes)) {
                cstCode += `\nexport class ${name} {\n`;
                cstCode += `    constructor(${Object.keys(args).join(", ")}) {\n`;
                for (const arg of Object.keys(args)) {
                    cstCode += `        this.${arg} = ${arg};\n`;
                }
                cstCode += "    }\n\n";
                cstCode += `    accept(visitor) {\n`;
                cstCode += `        if (visitor instanceof Visitor) {\n`;
                cstCode += `            return visitor.visit${name}(this);\n`;
                cstCode += `        }\n`;
                cstCode += `        throw new Error('Visitor not implemented correctly');\n`;
                cstCode += "    }\n";
                cstCode += "}";
            }
            descargarArchivo(cstCode, "CST.js");
        }

        function descargarArchivo(contenido, nombreArchivo) {
            const blob = new Blob([contenido], { type: "text/javascript" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = nombreArchivo;
            link.click();
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>